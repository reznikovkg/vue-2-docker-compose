<template>
  <div :class="['desk', generateStyleByType('desk')]" @click="() => $emit('click')">
    <div class="desk__icon">
      <svg v-if="isMelee" :class="['icon', generateStyleByType('icon')]" width="88px" height="88px"
        viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
        <path
          d="M499.78 16.125L477.157 22.5l-151.47 42.53-6.592 1.876-.22 6.844-.905 29.344-18.814 5.03-6.656 1.75-.28 6.907-.97 24.657-134.125 133.594-2.875 2.876.125 4.063c.71 20.398-14.288 31.957-22.75 31.217-9.973-.872-15.33-4.037-18.875-8.437-3.544-4.4-5.546-10.93-5.5-19.656l.125-24.156-16.344 17.78c-17.327 18.843-26.697 42.824-26.843 66.97l-.062 9.406h9.406c12.214.003 24.46 2.815 35.72 8.344l-4.063 14.468c-20.925 17.263-41.855 40.54-52.968 59.97-1.636 2.857-2.977 5.514-4.064 7.968L16.25 454.75l-1.5 41.656 41.656-1.5 9-32.187c2.383-1.07 4.96-2.36 7.72-3.94 19.338-11.062 42.48-31.857 59.718-52.686l14.47-4.063c5.345 11.147 8.143 23.224 8.186 35.064l.03 9.312h9.314c24.72.007 49.722-9.366 68.844-27.53l13.906-13.22-19-2.78c-10.576-1.556-18.374-5.412-23.03-9.75-4.66-4.34-6.335-8.744-5.876-13.626 1.054-11.204 4.174-16.044 8.437-19.063 4.263-3.018 11.267-4.52 21.094-4.218l4.06.124 2.845-2.875 136.313-136.314 18.968-.47 6.938-.186 1.844-6.688 4.437-16.093 32.906-1.44 6.75-.28 1.845-6.53L491.75 36.624l8.03-20.5zM466.157 45L429.97 173.906 397 175.312l-6.78.282-1.814 6.594-4.406 16-15.75.375-3.72.093-2.655 2.625-136.28 136.314c-9.812.1-19.142 1.668-27.064 6.812l.69-19.25 144.343-144.344 26.437-1.03L374.625 163l1.844-6.656 6.905-.188 32.25-.937 22.938-82.595-82.594 22.938L355 125.5l-.22 6.875-6.655 1.844-19.03 5.186-.876 30.344-142.25 142.22-21.19.75c4.803-7.545 7.843-16.86 8.22-27.158l134-133.437 2.625-2.594.125-3.655.875-21.47 18.875-5.03 6.72-1.813.186-6.937.938-29.438L466.156 45zM93.03 307.78c1.38 3.076 3.004 6.015 5.157 8.69 4.966 6.163 11.98 10.684 20.5 13.217l-4.343 15.5c-9.857-4.416-20.287-7.18-30.844-8.25 1.23-10.044 4.448-19.957 9.53-29.156zm87.25 23.095l-1.53 42.97-57.5 16.092 16.063-57.53 42.968-1.532zm2.657 61.22c2.006 5.516 5.43 10.576 9.875 14.717 3.934 3.665 8.684 6.685 14.032 9.094-10.278 6.204-21.67 9.998-33.188 11.28-1.086-10.328-3.84-20.554-8.125-30.248l17.407-4.844z" />
      </svg>
      <svg v-else :class="['icon', generateStyleByType('icon')]" width="80px" height="80px" version="1.1" id="Layer_1"
        xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512.001 512.001"
        xml:space="preserve">
        <g>
          <g>
            <path d="M460.416,115.627c6.716,0,12.781-4.017,15.403-10.2l34.81-82.127c5.852-13.803-8.109-27.787-21.931-21.93l-82.127,34.81
          c-6.183,2.621-10.2,8.686-10.2,15.403V91.97l-26.503,26.503C326.089,79.752,264.077,48.539,200.53,33.696
          C121.989,15.355,53.283,24.312,7.045,58.912c-8.256,6.085-9.071,18.119-1.9,25.29L204.642,283.7l-50.482,50.482l-61.166-20.388
          c-6.009-2.002-12.638-0.439-17.119,4.042L4.901,388.81c-8.775,8.774-5.257,23.766,6.539,27.699l63.038,21.012l21.012,63.038
          c3.91,11.728,18.874,15.364,27.699,6.539l70.974-70.974c4.481-4.481,6.045-11.108,4.042-17.119l-20.389-61.167l50.481-50.481
          l199.499,199.499c7.152,7.16,19.103,6.354,25.214-1.793c34.666-46.24,43.65-114.992,25.293-193.591
          c-14.842-63.548-46.055-125.56-84.776-169.343l26.503-26.503H460.416z M429.832,62.66l33.861-14.352l-14.352,33.861h-19.509V62.66
          z M83.186,405.155l-35.487-11.828l44.524-44.523l35.486,11.828C124.748,363.593,91.228,397.113,83.186,405.155z M118.673,464.301
          l-11.828-35.486l44.524-44.524l11.828,35.486L118.673,464.301z M192.92,66.277c57.653,13.464,113.659,41.363,153.253,75.893
          l-23.602,23.602c-35.833-31.927-87.854-64.139-139.906-86.238c-16.544-7.023-39.118-15.504-63.827-21.668
          C141.679,57.35,166.573,60.124,192.92,66.277z M51.307,83.049c31.669-1.322,72.996,8.058,118.284,27.283
          c48.273,20.493,96.235,49.989,129.29,79.13l-70.58,70.58L51.307,83.049z M428.952,460.694L251.958,283.7l70.581-70.58
          c29.143,33.056,58.638,81.017,79.13,129.291C420.894,387.697,430.272,429.026,428.952,460.694z M445.724,319.081
          c6.154,26.349,8.93,51.245,8.412,74.085c-6.164-24.709-14.647-47.285-21.67-63.83c-22.097-52.052-54.309-104.074-86.237-139.907
          l23.602-23.602C404.361,205.421,432.258,261.428,445.724,319.081z" />
          </g>
        </g>
      </svg>
    </div>
    <div class="desk__cards">
      <GameCard v-for="(card, index) in cards" :key="index" :score="card.score" @click="() => removeCard(index)" />
    </div>
  </div>
</template>

<script>
import GameCard from "./Card";
import { mapGetters } from 'vuex';
import { TurnStates } from '@/engine/constants';

export default {
  components: {
    GameCard,
  },
  name: "GameDeskLine",
  props: {
    isMelee: {
      type: Boolean,
      required: true,
    },
    isOpponent: {
      type: Boolean,
      required: true,
    },
    cards: {
      type: Array,
      default() {
        return [];
      },
      validator(value) {
        return Array.isArray(value)
          && value.every(item => typeof item.score === "number");
      },
    },
  },
  methods: {
    generateStyleByType(parentStyleName) {
      return `${parentStyleName}--${this.isMelee ? 'melee' : 'range'}`;
    },
    removeCard(index) {
      if (this.isOpponent || this.getGameEngine.currentTurn !== TurnStates.PLAYER) {
        return;
      }

      if (this.isMelee) {
        this.getGameEngine.player.board.removeCardFromFirstLine(index);
      } else {
        this.getGameEngine.player.board.removeCardFromSecondLine(index);
      }
    },
  },
  computed: {
    ...mapGetters('gameEngine', [
      'getGameEngine',
    ]),
  },
}
</script>

<style scoped lang="less">
.desk {
  position: relative;
  z-index: 0;

  padding: 5px;
  border-radius: 7px;

  min-height: 225px;

  &__icon {
    position: absolute;
    z-index: -1;

    top: 50%;
    transform: translate(25px, -50%);
  }

  &__cards {
    position: relative;
    padding: 10px;

    display: flex;
    flex-direction: row;

    justify-content: center;
    align-items: center;

    gap: 5px;
  }

  &--melee {
    background-color: rgb(177, 171, 148);
  }

  &--range {
    background-color: rgb(166, 173, 171);
  }
}

.icon {
  &--melee {
    fill: rgb(231, 229, 215);
  }

  &--range {
    fill: rgb(229, 229, 229);
  }
}
</style>
